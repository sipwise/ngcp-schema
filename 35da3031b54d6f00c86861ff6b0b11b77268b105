{
  "comments": [
    {
      "key": {
        "uuid": "da1255d7_dea5c1b5",
        "filename": "lib/NGCP/Schema/Result/voip_numbers.pm",
        "patchSetId": 2
      },
      "lineNbr": 99,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2019-01-28T10:25:47Z",
      "side": 1,
      "message": "it\u0027s not most clear as it seems.\n\ncan you state clearly, why the simple where-based query structure below *can\u0027t* be used?\n\nselect\n ...\nfrom billing.voip_numbers n\nleft join billing subscribers s on n.susbcriber_id\u003ds.id\n(inner) join billing.contract c on s.contract_id \u003d c.id\n(inner) join ..\n(inner) join ..\nwhere\nc.id \u003d x\ns.status !\u003d \u0027terminated\"\nn.id \u003d s.primary_number_id;",
      "revId": "35da3031b54d6f00c86861ff6b0b11b77268b105",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "da1255d7_5e79d12e",
        "filename": "lib/NGCP/Schema/Result/voip_numbers.pm",
        "patchSetId": 2
      },
      "lineNbr": 99,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2019-01-28T10:43:25Z",
      "side": 1,
      "message": "Because \n1. We can have (and it is ok) both terminated and active subscribers that use this number as primary number:\n\nhttps://paste.mgm.sipwise.com/show/4831/\n\nAnd in the same time we need full list of numbers both for showing and processing.\n\nThere is no correct way to select it with join on id\u003dprimary_number_id condition + where on status.\n\nOther correct way to select this data would be using exists, like:\n\nselect n.id,exists(select p.id from billing.voip_subscribers p where p.primary_number_id\u003dn.id and p.status !\u003d \u0027terminated\u0027) from billing.voip_numbers n;",
      "parentUuid": "da1255d7_dea5c1b5",
      "revId": "35da3031b54d6f00c86861ff6b0b11b77268b105",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "da1255d7_de93814e",
        "filename": "lib/NGCP/Schema/Result/voip_numbers.pm",
        "patchSetId": 2
      },
      "lineNbr": 99,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2019-01-28T11:21:59Z",
      "side": 1,
      "message": "\u003eThere is no correct way to select ..\n\nhis what i\u0027m trying to point out:\n\nselect\n ...\nfrom billing.voip_numbers n\nleft join billing subscribers s on n.susbcriber_id\u003ds.id\n(inner) join billing.contract c on s.contract_id \u003d c.id\n(inner) join ..\n(inner) join ..\nwhere\nc.id \u003d x\nand (\n  n.id \u003d s.primary_number_id\n  or s.status !\u003d \u0027terminated\"\n)",
      "parentUuid": "da1255d7_5e79d12e",
      "revId": "35da3031b54d6f00c86861ff6b0b11b77268b105",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "da1255d7_5ef55181",
        "filename": "lib/NGCP/Schema/Result/voip_numbers.pm",
        "patchSetId": 2
      },
      "lineNbr": 99,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2019-01-28T11:59:34Z",
      "side": 1,
      "message": "This is where I started from with my fix, as I posted in the chat on Thursday. But we need all rows from voip_numbers (for pilot, but it is not important here) except those that have active primary_number subscribers. So using where in first glance looks as:\n\n(As I posted in the chat)\n\nselect * from billing.voip_numbers n\nleft join billing.voip_subscriber p on n.id\u003dp.primary_number_id\nwhere \np.id is null or p.status \u003d \u0027terminated\u0027;\n\n\nBut it doesn\u0027t consider that we can have terminated and active subscriber with this primary_number_id in the same time. Please, look at the:\n\nhttps://paste.mgm.sipwise.com/show/4831/\n\nAs far as we have multiple data in the right table (\"p\" in the query above), we need or correct or just existence checking, like some kind of information aggregation from multiple connected rows from \"p\" table.\n\nI preferred the way of the correct join, as far as we need this information in two places, so we have one place in ngcp-schema to manage active primary number existance condition, and don\u0027t spread weird SQL::Abstract constructions through the code.",
      "parentUuid": "da1255d7_de93814e",
      "revId": "35da3031b54d6f00c86861ff6b0b11b77268b105",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    }
  ]
}